<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DrunkFrog</title>
  <link href="style.css" rel="stylesheet" type="text/css" media="all">
  <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
  <link rel="manifest" href="favicon/site.webmanifest">
</head>
<style>
  .window {
    padding: 10px;
  }
</style>
<body onload="showExternalContent('post/game_design.html'); showDailyPopup()">
  <div class="logo" onclick="window.location.href='index.html'"> </div>
  <div class="window-body">
    <menu role="tablist">
      <li onclick="showExternalContent('post/game_design.html')" role="tab" aria-selected="true"><a href="#tabs">Home Page</a></li>
      <li onclick="showExternalContent('post/game_design.html')" role="tab" aria-selected="false"><a href="#tabs">Game Design</a></li>
      <li onclick="showExternalContent('post/about_me.html')" role="tab" aria-selected="false"><a href="#tabs">About Me</a></li>
    </menu>
    <div class="window" role="tabpanel">
      <div class="window-body"></div>
    </div>
  </div>

  <button class="back-to-top" onclick="scrollToTop()">▲</button>
  <div class="crt monitor"></div>

  <script>
    // 配置项：弹窗展示时间间隔，单位为秒
    const popupInterval = 86400; // 默认值为 24 小时（86400 秒）

    function showExternalContent(url) {
      console.log('showExternalContent called with url:', url);
      fetchAndProcess(url, displayContent, displayError);
    }

    function fetchAndProcess(url, successCallback, errorCallback) {
      fetch(url)
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok ' + response.statusText);
          }
          return response.text();
        })
        .then(data => successCallback(data))
        .catch(error => {
          console.error('Error loading content:', error);
          errorCallback(error);
        });
    }

    function displayContent(html) {
      const content = document.querySelector('.window');
      content.classList.remove('active');
      const parser = new DOMParser();
      const doc = parser.parseFromString(html, "text/html");

      const externalTitle = doc.querySelector('title')?.innerText || "Default Title";
      const currentTitle = document.title.split(' - ')[0];
      document.title = `${currentTitle} - ${externalTitle}`;

      const titleElement = document.createElement('h3');
      titleElement.textContent = externalTitle;

      const bodyContent = doc.querySelector('body').innerHTML;
      content.innerHTML = '';

      const fragment = document.createDocumentFragment();
      fragment.appendChild(titleElement);

      const tempDiv = document.createElement('div');
      tempDiv.innerHTML = bodyContent;

      while (tempDiv.firstChild) {
        fragment.appendChild(tempDiv.firstChild);
      }

      content.appendChild(fragment);
      setTimeout(() => content.classList.add('active'), 10);
    }

    function displayError(error) {
      const content = document.querySelector('.window');
      content.innerHTML = `<p>Error loading content: ${error.message}</p>`;
      content.classList.add('active');
    }

    function scrollToTop() {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function handleScroll() {
      const button = document.querySelector('.back-to-top');
      button.style.display = window.scrollY > 300 ? 'block' : 'none';
    }

    function showDailyPopup() {
      const now = new Date();
      const lastShown = localStorage.getItem('dailyPopupLastShown');
      const lastShownDate = lastShown ? new Date(lastShown) : null;

      if (!lastShownDate || (now - lastShownDate) / 1000 >= popupInterval) {
        fetchAndProcess('ui/dailyPopup.html', displayPopupContent, error => {
          console.error('Error loading daily popup:', error);
        });
      }
    }

    function displayPopupContent(html) {
      const parser = new DOMParser();
      const doc = parser.parseFromString(html, "text/html");

      const popupContent = doc.querySelector('body').innerHTML;
      const popupContainer = document.createElement('div');
      popupContainer.innerHTML = popupContent;
      document.body.appendChild(popupContainer);

      // 确保 CSS 和 JS 代码生效
      const styles = doc.querySelectorAll('style');
      styles.forEach(style => {
        document.head.appendChild(style);
      });

      const scripts = doc.querySelectorAll('script');
      scripts.forEach(script => {
        const newScript = document.createElement('script');
        newScript.textContent = script.textContent;
        document.body.appendChild(newScript);
      });

      localStorage.setItem('dailyPopupLastShown', new Date().toISOString());
    }

    document.addEventListener('DOMContentLoaded', function() {
      const tabs = document.querySelectorAll('[role="tab"]');

      tabs.forEach(tab => {
        tab.addEventListener('click', function() {
          tabs.forEach(t => t.setAttribute('aria-selected', 'false'));
          this.setAttribute('aria-selected', 'true');
        });
      });

      window.addEventListener('scroll', handleScroll);
      handleScroll();

      fetchAndProcess('/ui/footer.html', data => {
        document.querySelector('.dynamic-footer').innerHTML = data;
      }, error => {
        console.error('Error loading footer:', error);
      });
    });

  </script>
</body>
<div class="dynamic-footer"></div>
</html>
